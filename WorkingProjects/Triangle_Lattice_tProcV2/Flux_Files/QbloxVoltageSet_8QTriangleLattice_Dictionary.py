from WorkingProjects.Inductive_Coupler.Client_modules.PythonDrivers.SPIRackvoltage import SPIRack, D5aModule
import numpy as np
COM_speed = 1e6  # Baud rate, doesn't matter much
timeout = 1  # In seconds
port = 'COM3'
spi_rack = SPIRack(port, COM_speed, timeout)
D5a = D5aModule(spi_rack, module=2, reset_voltages=False, ramp_step=0.003, ramp_interval=0.01)

span = D5a.range_4V_bi
# span = D5a.range_8V_uni

# span = D5a.range_2V_bi
for i in range(D5a._num_dacs):
    if not D5a.get_settings(i)[1] == span:
        current_settings = D5a.get_settings(i)
        D5a.change_span(i, span)
        D5a.set_voltage(i, current_settings[0])
################
set_unused_to_zero = True

DAC_Definitions = {
    'Q1': 1,
    'Q2': 2,
    'Q3': 3,
    'Q4': 4,
    'Q5': 5,
    'Q6': 6,
    'Q7': 7,
    'Q8': 8,
    'C1': 9,
    'C2': 10,
    'C3': 11,
    'C4': 12,
    'C5': 13,
    'C6': 14,
}

Voltage_Dictionary = {
    'Q1': 0,
    'Q2': 0,
    'Q3': 0,
    'Q4': 0,
    'Q5': 0,
    'Q6': 0,
    'Q7': 0,
    'Q8': 0,
    'C1': 0,
    'C2': 0,
    'C3': 0,
    'C4': 0,
    'C5': 0,
    'C6': 0
}

Voltage_Dictionary = {
    'Q1': -0.476,  # 4030.04
    'Q2': -0.5494,  # 4033.69
    'Q3': -0.5487,  # 3990.75
    'Q4': -0.5791,  # 4040.36
    'Q5': -0.5589,  # 4011.39
    'Q6': -0.5488,  # 4004.5
    'Q7': -0.5876,  # 3949.92
    'Q8': -0.5661,  # 4030.69
    'C1': -0.1772,  # 5850.93
    'C2': -0.2043,  # 6055.73
    'C3': -0.2341,  # 5782.42
    'C4': -0.2151,  # 5807.07
    'C5': -0.2038,  # 6135.67
    'C6': -0.0613,  # 5884.6
}


Voltage_Dictionary = {
    'Q1': -1.051,  # 3518.8
    'Q2': -0.8461,  # 3699.97
    'Q3': -0.475,  # 3899.99
    'Q4': -0.5251,  # 4099.98
    'Q5': -1.1352,  # 3503.55
    'Q6': -1.1923,  # 3507.7
    'Q7': -1.1785,  # 3442.08
    'Q8': -1.1936,  # 3506.04
    'C1': -0.1852,  # 5850.93
    'C2': -0.2132,  # 6055.73
    'C3': -0.2413,  # 5782.42
    'C4': -0.2256,  # 5807.07
    'C5': -0.2009,  # 6135.67
    'C6': -0.0939,  # 5884.6
}


Voltage_Dictionary = {
    'Q1': -1.051,  # 3518.8
    'Q2': -0.8461,  # 3699.97
    'Q3': -0.475,  # 3899.99
    'Q4': -0.5251,  # 4099.98
    'Q5': -1.1352,  # 3503.55
    'Q6': -1.1923,  # 3507.7
    'Q7': -1.1785,  # 3442.08
    'Q8': -1.1936,  # 3506.04
    'C1': 0.8,  # 5850.93
    'C2': 0.6,  # 6055.73
    'C3': -0.2413,  # 5782.42
    'C4': -0.2256,  # 5807.07
    'C5': -0.2009,  # 6135.67
    'C6': -0.0939,  # 5884.6
}

# Voltage_Dictionary = {
#     'Q1': 1.2413,  # 3518.8
#     'Q2': -0.8665,  # 3699.95
#     'Q3': -0.6192,  # 3900.02
#     'Q4': -0.5271,  # 4100.03
#     'Q5': 0.0244,  # 4379.97
#     'Q6': 0.0896,  # 4367.24
#     'Q7': 0.0121,  # 4315.28
#     'Q8': 0.0577,  # 4405.78
#     'C1': -0.1833,  # 5850.93
#     'C2': -0.1867,  # 6055.73
#     'C3': -0.2348,  # 5782.42
#     'C4': -0.2109,  # 5807.07
#     'C5': -0.2145,  # 6135.67
#     'C6': -0.0541,  # 5884.6
# }
#
# Voltage_Dictionary = {
#     'Q1': -0.5011,  # 4030.08
#     'Q2': -0.6412,  # 4033.7
#     'Q3': -0.408,  # 3990.71
#     'Q4': -0.8124,  # 4040.37
#     'Q5': -0.3929,  # 4011.36
#     'Q6': -0.7022,  # 4004.56
#     'Q7': -0.4555,  # 3949.91
#     'Q8': -0.5808,  # 4030.68
#     'C1': -0.155,  # 5850.93
#     'C2': -0.2191,  # 6055.73
#     'C3': -0.2304,  # 5782.42
#     'C4': -0.2145,  # 5807.07
#     'C5': -0.2131,  # 6135.67
#     'C6': -0.0415,  # 5884.6
# }


Voltage_Dictionary = {
    'Q1': -0.5011,  # 4030.08
    'Q2': -0.6412,  # 4033.7
    'Q3': -0.408,  # 3990.71
    'Q4': -0.8124,  # 4040.37
    'Q5': -0.3929,  # 4011.36
    'Q6': -0.7022,  # 4004.56
    'Q7': -0.4555,  # 3949.91
    'Q8': -0.5808,  # 4030.68
    'C1': -0.155,  # 5850.93
    'C2': -0.2191,  # 6055.73
    'C3': -0.2304,  # 5782.42
    'C4': -0.2145,  # 5807.07
    'C5': -0.2131,  # 6135.67
    'C6': -0.0415,  # 5884.6
}


# new voltages for current measurements
Voltage_Dictionary = {
    'Q1': -0.3647,  # 4200.01
    'Q2': -0.646,  # 3999.99
    'Q3': -0.7236,  # 3599.99
    'Q4': -1.0413,  # 3799.97
    'Q5': 0.1904,  # 4379.97
    'Q6': -0.0693,  # 4367.24
    'Q7': 0.1408,  # 4315.28
    'Q8': 0.0292,  # 4405.78
    'C1': 1.3548,  # 1518.39
    'C2': 1.3079,  # 1915.32
    'C3': -0.2302,  # 5782.42
    'C4': -0.2143,  # 5807.07
    'C5': -0.2338,  # 6135.67
    'C6': -0.0473,  # 5884.6
}

# new voltages for current measurements with couplers above
Voltage_Dictionary = {
    'Q1': -0.3538,  # 4199.99
    'Q2': -0.8198,  # 3800.05
    'Q3': -0.7381,  # 3600.0
    'Q4': -0.847,  # 4000.0
    'Q5': 0.1787,  # 4379.97
    'Q6': -0.0623,  # 4367.24
    'Q7': 0.1241,  # 4315.28
    'Q8': 0.0327,  # 4405.78
    'C1': 0.6008,  # 4914.05
    'C2': 0.5601,  # 5037.8
    'C3': -0.2198,  # 5782.42
    'C4': -0.2046,  # 5807.07
    'C5': -0.2163,  # 6135.67
    'C6': -0.0442,  # 5884.6
}

# current measurements: coupler below
Voltage_Dictionary = {
    'Q1': -0.071,  # 4380.01
    'Q2': -0.7764,  # 3850.03
    'Q3': -0.7188,  # 3600.0
    'Q4': -0.7741,  # 4100.0
    'Q5': 0.1965,  # 4379.97
    'Q6': -0.0807,  # 4367.24
    'Q7': 0.1493,  # 4315.28
    'Q8': 0.0383,  # 4405.78
    'C1': 1.3472,  # 177.58
    'C2': 1.3147,  # 333.74
    'C3': -0.2331,  # 5865.91
    'C4': -0.2188,  # 5927.78
    'C5': -0.2357,  # 5852.44
    'C6': -0.0529,  # 5955.07
}


# Voltage_Dictionary = {
#     'Q1': -1.034,  # 3518.8
#     'Q2': -1.2262,  # 3511.22
#     'Q3': -0.9843,  # 3462.87
#     'Q4': -0.1658,  # 4424.81
#     'Q5': -0.9749,  # 3503.55
#     'Q6': -1.3613,  # 3507.7
#     'Q7': -1.0647,  # 3442.08
#     'Q8': -1.2031,  # 3506.04
#     'C1': -0.1893,  # 5898.14
#     'C2': -0.2014,  # 5940.39
#     'C3': -0.2319,  # 5865.91
#     'C4': -0.2272,  # 5927.78
#     'C5': -0.1965,  # 5852.44
#     'C6': -0.069,  # 5955.07
# }

# new voltage point for correlations
Voltage_Dictionary = {
     'Q1': -0.0697, #4380.0
     'Q2': -0.8011, #3819.96
     'Q3': -0.7736, #3549.98
     'Q4': -0.7733, #4099.99
     'Q5': 0.1956, #4379.97
     'Q6': -0.0807, #4367.24
     'Q7': 0.1476, #4315.28
     'Q8': 0.0373, #4405.78
     'C1': 1.3457, #177.53
     'C2': 1.3159, #333.74
     'C3': -0.2324, #5865.91
     'C4': -0.2184, #5927.78
     'C5': -0.2345, #5852.44
     'C6': -0.0535, #5955.07
}

# voltages = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
for qubit_labels in DAC_Definitions.keys():
    D5a.set_voltage_ramp(DAC_Definitions[qubit_labels], Voltage_Dictionary[qubit_labels])

if set_unused_to_zero:
    for i in range(D5a._num_dacs):
        if i not in DAC_Definitions.values():
            D5a.set_voltage(i, 0)

for i in range(D5a._num_dacs):
    print(f'{i}: {np.round(D5a.get_settings(i)[0], 4)} V')
spi_rack.close()

# print(spi_rack.get_temperature())
# print(spi_rack.get_battery())
# print(spi_rack.get_firmware_version())

# 0 to 4 Volt: range_4V_uni (span 0)
# -4 to 4 Volt: range_4V_bi (span 2)
# -2 to 2 Volt: range_2V_bi (span 4)

